# Pixiu Phase 2 Redesign - Design Document

**Date**: 2026-02-27
**Author**: AI Assistant
**Status**: Draft for Implementation

---

## 1. Executive Summary

This redesign addresses four critical areas:
1. **Real Data Integration** - Wire UI to existing backend services
2. **Complete Backtest Flow** - Connect backtest engine to UI
3. **AI Report Generation** - Integrate GLM-5 analysis into results page
4. **UI/UX Overhaul** - Dark tech theme with clear user flow

**Key Insight**: Backend services (data_service, backtest_service, ai_service, strategies) are fully implemented. The problem is the UI layer uses placeholder mock data instead of calling real services.

---

## 2. Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        UI Layer (Reflex)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Home      â”‚  Backtest   â”‚  Settings   â”‚   Components            â”‚
â”‚   Page      â”‚  Page       â”‚  Page       â”‚   (Reusable)            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚             â”‚             â”‚
       â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     State Management                             â”‚
â”‚  (Single State class - all async methods yield for reactivity)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DataService â”‚    â”‚ Backtest    â”‚    â”‚  AIService  â”‚
â”‚  (akshare)  â”‚    â”‚  Engine     â”‚    â”‚   (GLM-5)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database   â”‚    â”‚ Strategies  â”‚
â”‚  (SQLite)   â”‚    â”‚  Registry   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. UI/UX Design - Dark Tech Theme

### 3.1 Color Palette

```python
COLORS = {
    # Backgrounds
    "bg_primary": "#0a0a0f",      # Near black
    "bg_secondary": "#12121a",    # Slightly lighter
    "bg_card": "#1a1a24",         # Card background
    "bg_hover": "#252532",        # Hover state
    
    # Accents (Tech neon)
    "accent_primary": "#00d9ff",  # Cyan
    "accent_secondary": "#7c3aed", # Purple
    "accent_success": "#10b981",  # Green
    "accent_danger": "#ef4444",   # Red
    "accent_warning": "#f59e0b",  # Orange
    
    # Text
    "text_primary": "#ffffff",    # White
    "text_secondary": "#a0a0b0",  # Gray
    "text_muted": "#6b7280",      # Muted gray
}
```

### 3.2 Page Layouts

#### Home Page - Clear 4-Step Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“Š PIXIU é‡åŒ–åˆ†æ                    [Aè‚¡] [æ¸¯è‚¡] [ç¾è‚¡] â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  STEP 1: é€‰æ‹©è‚¡ç¥¨                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” [ğŸ” æœç´¢]        â”‚  â”‚
â”‚  â”‚  â”‚ è¾“å…¥è‚¡ç¥¨ä»£ç æˆ–åç§°...               â”‚                  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚ 000001 å¹³å®‰é“¶è¡Œ    â”‚ 000002 ä¸‡ç§‘A    â”‚ ...        â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  STEP 2: é€‰æ‹©ç­–ç•¥                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
â”‚  â”‚  â”‚ âœ“ è¶‹åŠ¿å¼ºåº¦ç­–ç•¥  â”‚ â”‚ â—‹ æ³¢åŠ¨ç‡å¥—åˆ©   â”‚ â”‚ â—‹ å¡å°”æ›¼æ»¤æ³¢   â”‚â”‚  â”‚
â”‚  â”‚  â”‚ åŸºäºå¯¼æ•°åˆ†æ    â”‚ â”‚ å‡å€¼å›å½’äº¤æ˜“   â”‚ â”‚ çŠ¶æ€ç©ºé—´ä¼°è®¡   â”‚â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  STEP 3: é…ç½®å‚æ•°                    [âš™ é«˜çº§è®¾ç½®]        â”‚  â”‚
â”‚  â”‚  åˆå§‹èµ„é‡‘: [100000]  æ‰‹ç»­è´¹ç‡: [0.03%]  ä»“ä½: [95%]      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           [ ğŸš€ å¼€å§‹å›æµ‹åˆ†æ ]                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Backtest Results Page

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â† è¿”å›]        ğŸ“ˆ 000001 å¹³å®‰é“¶è¡Œ - å›æµ‹æŠ¥å‘Š                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ æ€»æ”¶ç›Šç‡     â”‚ â”‚ å¹´åŒ–æ”¶ç›Š     â”‚ â”‚ æœ€å¤§å›æ’¤     â”‚ â”‚ å¤æ™®æ¯”ç‡   â”‚â”‚
â”‚  â”‚  +45.2%     â”‚ â”‚  +18.5%     â”‚ â”‚  -12.3%     â”‚ â”‚   1.85    â”‚â”‚
â”‚  â”‚   ğŸŸ¢        â”‚ â”‚   ğŸŸ¢        â”‚ â”‚   ğŸ”´        â”‚ â”‚   ğŸŸ¢      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“Š èµ„é‡‘æ›²çº¿                                              â”‚  â”‚
â”‚  â”‚  [Plotly Chart - Interactive]                            â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“‹ äº¤æ˜“è®°å½•                           å…± 42 ç¬”äº¤æ˜“       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ æ—¥æœŸ  â”‚ ç±»å‹   â”‚ ä»·æ ¼   â”‚ æ•°é‡   â”‚ æ”¶ç›Š   â”‚ ç´¯è®¡   â”‚   â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚  â”‚
â”‚  â”‚  â”‚ ...  â”‚ ...    â”‚ ...    â”‚ ...    â”‚ ...    â”‚ ...    â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ¤– AI åˆ†ææŠ¥å‘Š                         [ç”Ÿæˆä¸­...]       â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  æ ¹æ®å›æµ‹ç»“æœï¼Œè¯¥ç­–ç•¥åœ¨å¹³å®‰é“¶è¡Œä¸Šè¡¨ç°è‰¯å¥½...              â”‚  â”‚
â”‚  â”‚  ...                                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚                           [ ğŸ“¥ å¯¼å‡ºæŠ¥å‘Š ]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Settings Page - Clean Form Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â† è¿”å›]              âš™ï¸ ç³»ç»Ÿè®¾ç½®                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ”‘ API é…ç½®                                              â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  GLM API Key                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  ç”¨äºç”Ÿæˆ AI æ™ºèƒ½åˆ†ææŠ¥å‘Š                                 â”‚  â”‚
â”‚  â”‚                                              [æµ‹è¯•è¿æ¥]   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ’° å›æµ‹å‚æ•°                                              â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  åˆå§‹èµ„é‡‘              æ‰‹ç»­è´¹ç‡              é»˜è®¤ä»“ä½      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
â”‚  â”‚  â”‚ 100000       â”‚     â”‚ 0.0003       â”‚     â”‚ 0.95       â”‚â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“Š æ•°æ®ç®¡ç†                                              â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  æ•°æ®åº“å¤§å°: 125 MB        ç¼“å­˜å¤§å°: 45 MB               â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  [ ğŸ—‘ï¸ æ¸…ç†ç¼“å­˜ ]          [ ğŸ“¥ å¯¼å‡ºæ•°æ® ]                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚                       [ ğŸ’¾ ä¿å­˜è®¾ç½® ]                          â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. State Management Redesign

### 4.1 State Variables

```python
class State(rx.State):
    # UI State
    is_loading: bool = False
    loading_message: str = ""
    progress: int = 0
    error_message: str = ""
    
    # Market & Search
    current_market: str = "Aè‚¡"
    search_keyword: str = ""
    search_results: List[Dict] = []
    
    # Stock Selection
    selected_stock: str = ""
    selected_stock_name: str = ""
    stock_data: Optional[Dict] = None  # OHLCV data
    
    # Strategy Selection
    available_strategies: List[Dict] = []  # From STRATEGY_REGISTRY
    selected_strategies: List[str] = []
    strategy_params: Dict[str, Dict] = {}  # Per-strategy params
    
    # Backtest
    backtest_config: Dict = {
        "initial_capital": 100000,
        "commission_rate": 0.0003,
        "position_size": 0.95,
    }
    backtest_results: List[Dict] = []  # Multiple strategy results
    current_result_index: int = 0
    
    # AI Report
    ai_report: str = ""
    ai_generating: bool = False
    
    # Settings
    glm_api_key: str = ""
```

### 4.2 State Methods (Async with Yield)

```python
async def search_stocks(self):
    """æœç´¢è‚¡ç¥¨ - è°ƒç”¨çœŸå® DataService"""
    self.is_loading = True
    self.error_message = ""
    yield
    
    try:
        db = Database("data/stocks.db")
        data_service = DataService(db)
        results = await data_service.search_stocks(
            self.search_keyword, 
            self.current_market
        )
        self.search_results = [
            {"code": s.code, "name": s.name, "market": s.market}
            for s in results
        ]
    except Exception as e:
        self.error_message = f"æœç´¢å¤±è´¥: {str(e)}"
    finally:
        self.is_loading = False
        yield

async def select_stock(self, code: str):
    """é€‰æ‹©è‚¡ç¥¨ - åŠ è½½å†å²æ•°æ®"""
    self.is_loading = True
    self.loading_message = "åŠ è½½è‚¡ç¥¨æ•°æ®..."
    yield
    
    try:
        # ... load data via DataService
    finally:
        self.is_loading = False
        yield

async def run_backtest(self):
    """æ‰§è¡Œå›æµ‹ - è°ƒç”¨ BacktestEngine"""
    self.is_loading = True
    self.progress = 0
    yield
    
    try:
        for i, strategy_name in enumerate(self.selected_strategies):
            self.loading_message = f"å›æµ‹ {strategy_name}..."
            yield
            
            # Get strategy from registry
            strategy = get_strategy(strategy_name)
            engine = BacktestEngine(self.backtest_config)
            result = engine.run(df, strategy)
            self.backtest_results.append(result)
            
            self.progress = int((i + 1) / len(self.selected_strategies) * 100)
            yield
        
        # Navigate to results page
        return rx.redirect("/backtest")
    finally:
        self.is_loading = False
        yield

async def generate_ai_report(self):
    """ç”Ÿæˆ AI æŠ¥å‘Š - è°ƒç”¨ AIService"""
    self.ai_generating = True
    yield
    
    try:
        ai_service = AIService(self.glm_api_key)
        self.ai_report = await ai_service.generate_analysis_report(
            stock_code=self.selected_stock,
            stock_name=self.selected_stock_name,
            backtest_results=self.backtest_results
        )
    finally:
        self.ai_generating = False
        yield
```

---

## 5. Component Library

Create reusable components in `pixiu/components/`:

### 5.1 Core Components

| Component | File | Purpose |
|-----------|------|---------|
| `MetricCard` | `metric_card.py` | Display single metric with color |
| `StockCard` | `stock_card.py` | Search result item |
| `StrategyCard` | `strategy_card.py` | Selectable strategy tile |
| `Chart` | `chart.py` | Plotly wrapper for equity curve |
| `DataTable` | `data_table.py` | Trade history table |
| `LoadingOverlay` | `loading.py` | Full-screen loading state |
| `Toast` | `toast.py` | Error/success notifications |

### 5.2 Metric Card Example

```python
def metric_card(
    title: str,
    value: str,
    change: Optional[str] = None,
    is_positive: bool = True,
) -> rx.Component:
    color = "accent_success" if is_positive else "accent_danger"
    return rx.box(
        rx.vstack(
            rx.text(title, color="text_secondary", font_size="sm"),
            rx.hstack(
                rx.text(value, font_size="2xl", font_weight="bold", color="text_primary"),
                rx.cond(
                    change,
                    rx.badge(change, color_scheme=color),
                ),
            ),
            spacing="1",
        ),
        bg="bg_card",
        padding="1rem",
        border_radius="lg",
        border=f"1px solid {COLORS['bg_hover']}",
    )
```

---

## 6. Data Flow

```
User Action                State Method              Service Called
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Select Market     â†’    set_market()              None
2. Type Keyword      â†’    set_search_keyword()      None
3. Click Search      â†’    search_stocks()           DataService.search_stocks()
4. Click Stock       â†’    select_stock()            DataService.get_cached_data()
                                                 DataService.download_and_save()
5. Click Strategy    â†’    toggle_strategy()         None (local state)
6. Click Backtest    â†’    run_backtest()            BacktestEngine.run()
                                                 Strategy.generate_signals()
7. View Results      â†’    (auto on page load)       None
8. Generate AI       â†’    generate_ai_report()      AIService.generate_analysis_report()
9. Save Settings     â†’    save_settings()           Config update
```

---

## 7. Error Handling Strategy

### 7.1 User-Facing Errors

| Error Type | User Message | Recovery |
|------------|--------------|----------|
| Network Error | "ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ" | Retry button |
| Invalid Stock | "æœªæ‰¾åˆ°è¯¥è‚¡ç¥¨ï¼Œè¯·æ£€æŸ¥ä»£ç " | Clear input |
| API Error | "API è°ƒç”¨å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•" | Retry button |
| No Data | "è¯¥è‚¡ç¥¨æš‚æ— å†å²æ•°æ®" | Suggest another stock |
| Backtest Error | "å›æµ‹æ‰§è¡Œå¤±è´¥ï¼š{detail}" | Show detail, suggest fix |

### 7.2 Implementation

```python
# In State class
error_message: str = ""

async def safe_execute(self, coro, error_msg: str):
    """Wrapper for safe async execution"""
    try:
        return await coro
    except Exception as e:
        self.error_message = f"{error_msg}: {str(e)}"
        yield
        return None

# In UI
rx.cond(
    State.error_message != "",
    rx.alert(State.error_message, status="error"),
)
```

---

## 8. File Structure After Redesign

```
pixiu/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ metric_card.py      # Metric display card
â”‚   â”œâ”€â”€ stock_card.py       # Stock search result item
â”‚   â”œâ”€â”€ strategy_card.py    # Strategy selection tile
â”‚   â”œâ”€â”€ chart.py            # Plotly equity curve
â”‚   â”œâ”€â”€ data_table.py       # Trade history table
â”‚   â””â”€â”€ loading.py          # Loading overlay
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ home.py             # Redesigned with 4-step flow
â”‚   â”œâ”€â”€ backtest.py         # Full results with charts
â”‚   â””â”€â”€ settings.py         # Clean form layout
â”œâ”€â”€ state.py                # Wired to real services
â””â”€â”€ theme.py                # Dark theme configuration
```

---

## 9. Implementation Phases

### Phase 1: Foundation (Est. 2-3 hours)
- [ ] Create `theme.py` with dark color palette
- [ ] Create reusable components in `components/`
- [ ] Wire State class to real services

### Phase 2: Core Pages (Est. 3-4 hours)
- [ ] Redesign home.py with clear 4-step flow
- [ ] Implement real search via DataService
- [ ] Wire strategy selection to STRATEGY_REGISTRY
- [ ] Connect backtest execution to BacktestEngine

### Phase 3: Results & AI (Est. 2-3 hours)
- [ ] Build backtest.py with metrics display
- [ ] Add Plotly equity curve chart
- [ ] Implement trade history table
- [ ] Wire AI report generation

### Phase 4: Polish (Est. 1-2 hours)
- [ ] Redesign settings.py with clean layout
- [ ] Add error handling and user feedback
- [ ] Test full flow end-to-end

---

## 10. Success Criteria

1. **Search works** - Real stock data from akshare
2. **Backtest runs** - Real metrics from BacktestEngine
3. **AI generates** - Real report from GLM-5
4. **UI is usable** - Clear flow, readable text, consistent colors
5. **No errors** - Graceful error handling, no crashes

---

## 11. Dependencies (Already Installed)

All required packages are in requirements.txt:
- reflex >= 0.4.0
- akshare >= 1.12.0
- zhipuai >= 2.0.0
- plotly >= 5.18.0
- pandas >= 2.0.0
- numpy >= 1.24.0

No new dependencies needed.
